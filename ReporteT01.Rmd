---
title: "ReporteT01"
author: "Jessica Garcia, Manuel Rivera, Axel Rodriguez"
date: "2023-02-10"
output:
  html_document:
    toc: true # table of content true
    toc_float: yes
    toc_depth: 3  # upto three depths of headings (specified by #, ## and ###)
    number_sections: true  ## if you want number sections at each table header
    theme: united  # many options for theme, this one is my favorite.
    highlight: tango  # specifies the syntax highlighting style
  pdf_document: 
    toc: true
    toc_depth: 3
    number_sections: true
---

# Practica archivo BAM

```bash
# Entrar a un qlogin
qlogin
# Entrar a la carpeta donde se encuentra el archivp
cd /mnt/Timina/bioinfoII/format_qc
# Se copia el archivo a la caarpeta donde se estara trabajando trabajando
cp NA20538.bam /mnt/Timina/bioinfoII/arodriguez
# Dirigirse a la carpeta donde se trabaja
```



# Practica archivo bfc

## What is a BCF?

Un BCF es el archivo binario del VCF.

#https://evomics.org/vcf-and-bcf/#:~:text=BCF%2C%20or%20the%20binary%20variant,that%20between%20BAM%20and%20SAM.

##  Can you convert bcf to vcf using bcftools? How?

Si es posible convertir un bcf a vcf utilizando el comando $view$

```bash
#Convertir un BCG --> VCF
bcftools view 1kg.bcf -o 1kg.vcf
```

## How many samples are in the BCF? Hint: use the -l option.

Hay 50 muestras en total.

```bash

# Muestra los nombres de las muestras
bcftools query -l 1kg.vcf

# Muestra el numero de muestras con un pípeline
bcftools query -l file.bcf | wc -l
```

## "What is the genotype of the sample HG00107 at the position
20:24019472? Hint: use the combination of -r, -s, and -f '[ %TGT]\n'
options"

```bash

#Comprimir VCF --> GZIP
bcftools view 1kg.vcf -Oz -o 1kg.vcf.gz

#Filtrar por nombre de la muestra
bcftools view -s HG00107 1kg.vcf.gz
 
#INDEX
bcftools index 1kg.vcf.gz

#Filtrar por posicion de la muestra y nombre
bcftools view -r 20:24019472 -s HG00107 1kg.vcf.gz

#Mostrar el genotipo
bcftools view -r 20:24019472 -s HG00107 1kg.vcf.gz | bcftools query -f '[ %TGT]\n' 
```


## How many positions there are with more than 10 alternate alleles?
(See the INFO/AC tag.) Hint: use the -i filtering option

```bash
# Saber posiciones
bcftools view -i 'AC>10' 1kg.vcf| wc -l

```


## List all positions where HG00107 has a non-reference genotype and
the read depth is bigger than 10.

```bash

# Mostrar la cobertura
bcftools query -f '[ % DP]\n'

# Filtrar por nombre
bcftools view -s HG00107 1kg.vcf

# Filtrar por no tener genoma de referencia
bcftools view -i 'GT="alt"' 1kg.vcf

# Ambos filtros
bcftools view -s HG00107 -i ' GT="." && DP>10' 1kg.vcf | wc -l #DUDA
bcftools view -s HG00107 -i ' REF="." && DP>10' 1kg.vcf | wc -l #DUDA

#Contar las posiciones
bcftools view -s HG00107 -i ' REF="." && DP>10' 1kg.vcf | wc -l #DUDA

#PRUEBA
bcftools view -r 20:29908139 -s HG00107 1kg.vcf.gz 
29908139
```

#Practicas estadisticas

##¿Cual es numero total de lecturas?
Usando el comando `samtools flagstat` se puede observar las estadisticas generales del archivo BAM. Si lo que se requiere saber es el **numero total de lecturas**, entonces se utiliza el comando:

```bash
samtools flagstat NA20538.bam | head -n 1
```

En donde el comando `head -n 1` funciona para imprimir solo la primera linea del output, donde se encuentran el numero de lecturas totales.

```bash
347367 + 0 in total (QC-passed reads + QC-failed reads)
```

Como se observa, el numero de lecturas totales fue de **347,367**.

### Otras alternativas

```bash
# Estadisticas generales
samtools flagstat NA20538.bam
# Lecturas totales ejemplo 2
samtools view -c NA20538.bam # 347367
# Lecturas totales ejemplo 3
samtools stats NA20538.bam | grep 'SN' | cut -f 2- # 347367
# Lecturas totales ejemplo 4
samtools stats NA20538.bam | grep 'raw total sequences' | cut -f 2- # 347367
```

- `view -c` cuenta los alineamientos e imprime el total.
- `samtools stats` muestra estadísticas relevantes sobre cada lane y grupo de lectura, así como información sobre las secuencias.
- `grep` busca e imprime las lineas coincidentes con un patron (en el ej.3 `‘SN’`)
- La seccin `SN`  del comando `samtools stats` brinda un resumen con conteos, porcentajes y promedios, en un estilo similar al de `samtools flagstat`, pero más completo.
- `cut` se utiliza para seleccionar una columna del output. Con el parametro `-f 2-` le indicamos que solo queremos las ultimas dos columnas del output.
- `grep 'raw total sequences'` se utiliza para especificar que solo se requieren el total de lecturas, lo que nos da un output mas ordenado.

##¿Que proorcion de las lecturas fueron mapeadas?


Con el mismo comando de `samtools flagstat NA20538.bam`, se observa que el porcentaje de _reads_ mapeados fue de **93.26%** (323,966 lecturas). 

```bash
# Filtramos los resultados que coincidan con 'mapped' e imprimimos
# todos los argumentos de la primera fila
samtools flagstat NA20538.bam | grep 'mapped'| awk '{print $0}'| head -n 1
323966 + 0 mapped (93.26% : N/A)
```

El comando `awk '{print $0}'` imprimir la primera fila del output del comando `samtools flagstat NA20538.bam | grep 'mapped'`.

<div class="alert alert-block alert-info">
Generalmente `awk '{print $n}'` es utilizado para imprimir la $n$-esima columna de un output. `awk ‘NR==m {print $n}’` se utiliza para imprimir la $m$-esima fila y la $n$-esima columna.</div>


### Otras alternativas

```bash
# Lecturas mapeadas (Mapped alignments)

## Ejemplo 2
samtools view -F 0x904 -c NA20538.bam # 323966
## Ejemplo 3
samtools view -c -F 260 NA20538.bam # # 323966
## Ejemplo 4
samtools view -F 0x04 -c NA20538.bam # 323966
## Ejemplo 5
samtools stats NA20538.bam | grep 'SN' | grep 'reads mapped' | cut -f 2- #323966
```

## How many reads were mapped to a different chromosome?

```bash
samtools stats NA20538.bam | grep 'pairs on different chromosomes:' | cut -f 2-
```

De acuerdo a la seccion `SN` del archivo, **4,055** lecturas fueron mapeadas a un cromosoma diferente.

## What is the insert size mean and standard deviation?

```bash
samtools stats -F SECONDARY NA20538.bam | grep "insert size" | cut -f 2-
```

Finalmente, en la seccion de Sumary Numbers (`SN`) generada por `samtools stats` se encuentra la información requerida.

- insert size average:	**190.3**
- insert size standard deviation: **136.4**